{% extends "layout.html" %}
{% block content %}
<head>
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
</head>
<form action="/search" method="POST">
    <h2>Recipe Search</h2>
</form>
{%if success%}
<p>Number of recipes found for <b>{{ searchbar }}:</b> {{ length }}</p>
    
<div class="search_grid">
    {% for recipe in recipes %}
    <div class="search_result"> 
        <div class="wrapper">
            <div class="recipe_image">
                <img src="{{recipe.images}}" alt="image">
            </div>
            <ul>
                <p class="title">
                    <b>{{recipe.label}}</b>
                </p>
                <ul class="contents">
                    <li>{{recipe.protein}} Protein</li>
                    <li>{{recipe.calories}} Calories</li>
                    <li>{{recipe.servings}} Servings</li>
                    <li><b>{{recipe.protein_per_serv}} Protein/Serving</b></li>
                    <li><b>{{recipe.cal_per_serv}} Cal/Serving</b></li>
                    <a href='{{recipe.url}}'>From {{recipe.source}}</a>
                </ul>  
            </ul>
        </div>
        <details>
            <summary> <i class='bx bx-chevrons-up' ></i> </summary>
            <div class="group_btn">
                <form action="/scale_recipe" method="POST">
                    {% for ingredient in recipe.ingredients %}
                        <input type="hidden" name="ingredients[]" value="{{ ingredient }}">
                    {% endfor %}
                    <button type="submit" class="small_btn">Scale Recipe</button>
                </form>
                <form action="/calendar" method="POST">
                    <input type="hidden" name="recipe_label" value="{{ recipe.label }}">
                    <input type="hidden" name="recipe_url" value="{{ recipe.url }}">
                    <input type="hidden" name="recipe_uri" value="{{ recipe.uri }}">
                    <p>Debug URI: {{ recipe.uri }}</p>
                    <button type="submit" class="small_btn">Add to Calendar</button>
                </form>
                <form action="/cart" method="POST">
                    <button type="submit" name="recipeURI" class="small_btn" value="{{ recipe. uri }}">Add to Cart</button>
                </form>
                <form action="{{ url_for('calorie_tracking') }}" method="POST">
                    <input type="hidden" name="item_name" value="{{ recipe.label }}">
                    <input type="hidden" name="calories" value="{{ recipe.calories }}">
                    <input type="hidden" name="date" value="{{ current_date }}">
                    <button type="submit" class="small_btn">Add to Calorie Tracker</button>
                </form>
            </div>
            <p style="text-align: center"><b>Ingredients</b></p>
            <ul>
                {% for ingredient in recipe.ingredients %}
                <div>
                    <li>{{ingredient}}</li>
                </div>
                {% endfor %}
            </ul>
        </details>
    </div>
    {% endfor %}
</div>

<br><br><br><br>

{% elif success == false%}
    <style>
        .search_body {
            top: 5em;
        }
    </style>
{% endif %}
{% endblock %}